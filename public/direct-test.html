<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gideon's Tech Suite - Direct Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    .card {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .success {
      border-left: 4px solid #2ecc71;
    }
    .error {
      border-left: 4px solid #e74c3c;
    }
    .warning {
      border-left: 4px solid #f39c12;
    }
    .info {
      border-left: 4px solid #3498db;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #2980b9;
    }
    pre {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-success {
      background-color: #2ecc71;
    }
    .status-error {
      background-color: #e74c3c;
    }
    .status-pending {
      background-color: #f39c12;
    }
    .log-container {
      max-height: 200px;
      overflow-y: auto;
      background: #f8f8f8;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      margin-top: 10px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>Gideon's Tech Suite - Direct Test</h1>
  
  <div class="card info">
    <h2>Backend Connection Status</h2>
    <div id="connection-status">
      <span class="status-indicator status-pending"></span>
      <span>Checking connection...</span>
    </div>
    <div id="connection-details"></div>
  </div>

  <div class="card">
    <h2>API Test</h2>
    <button id="test-health">Test Health Endpoint</button>
    <button id="test-status">Test Status Endpoint</button>
    <button id="test-api">Test API Root</button>
    <div id="api-results" class="log-container"></div>
  </div>

  <div class="card">
    <h2>WebSocket Test</h2>
    <button id="test-ws">Test WebSocket Connection</button>
    <div id="ws-status"></div>
    <div id="ws-log" class="log-container"></div>
  </div>

  <div class="card">
    <h2>Authentication Test</h2>
    <p>Test login with demo credentials:</p>
    <button id="test-login">Test Login</button>
    <div id="auth-results" class="log-container"></div>
  </div>

  <script>
    // Configuration
    const API_URL = 'https://backend-4ptp8fu9r-gideonstechnologyltds-projects.vercel.app/api';
    const WS_URL = 'wss://backend-4ptp8fu9r-gideonstechnologyltds-projects.vercel.app/ws';
    
    // DOM Elements
    const connectionStatus = document.getElementById('connection-status');
    const connectionDetails = document.getElementById('connection-details');
    const apiResults = document.getElementById('api-results');
    const wsStatus = document.getElementById('ws-status');
    const wsLog = document.getElementById('ws-log');
    const authResults = document.getElementById('auth-results');
    
    // Helper function to log messages
    function logToElement(element, message, isError = false) {
      const logEntry = document.createElement('div');
      logEntry.style.color = isError ? '#e74c3c' : '#333';
      logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
      element.appendChild(logEntry);
      element.scrollTop = element.scrollHeight;
    }
    
    // Check initial connection
    async function checkConnection() {
      try {
        const response = await fetch(`${API_URL}/health`, { 
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          mode: 'cors'
        });
        
        if (response.ok) {
          const data = await response.json();
          connectionStatus.innerHTML = `
            <span class="status-indicator status-success"></span>
            <span>Connected to backend</span>
          `;
          connectionDetails.innerHTML = `
            <p><strong>API URL:</strong> ${API_URL}</p>
            <p><strong>WebSocket URL:</strong> ${WS_URL}</p>
            <p><strong>Server Status:</strong> ${data.status || 'OK'}</p>
            <p><strong>Environment:</strong> ${data.environment || 'production'}</p>
          `;
          return true;
        } else {
          throw new Error(`HTTP Error: ${response.status}`);
        }
      } catch (error) {
        connectionStatus.innerHTML = `
          <span class="status-indicator status-error"></span>
          <span>Connection failed</span>
        `;
        connectionDetails.innerHTML = `
          <p><strong>API URL:</strong> ${API_URL}</p>
          <p><strong>Error:</strong> ${error.message}</p>
          <p>Please check that the backend server is running and accessible.</p>
        `;
        return false;
      }
    }
    
    // Test health endpoint
    document.getElementById('test-health').addEventListener('click', async () => {
      logToElement(apiResults, 'Testing health endpoint...');
      
      try {
        const response = await fetch(`${API_URL}/health`, { 
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          mode: 'cors'
        });
        
        if (response.ok) {
          const data = await response.json();
          logToElement(apiResults, 'Health endpoint successful');
          logToElement(apiResults, `Response: ${JSON.stringify(data, null, 2)}`);
        } else {
          throw new Error(`HTTP Error: ${response.status}`);
        }
      } catch (error) {
        logToElement(apiResults, `Health endpoint error: ${error.message}`, true);
      }
    });
    
    // Test status endpoint
    document.getElementById('test-status').addEventListener('click', async () => {
      logToElement(apiResults, 'Testing status endpoint...');
      
      try {
        const response = await fetch(`${API_URL}/status`, { 
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          mode: 'cors'
        });
        
        if (response.ok) {
          const data = await response.json();
          logToElement(apiResults, 'Status endpoint successful');
          logToElement(apiResults, `Response: ${JSON.stringify(data, null, 2)}`);
        } else {
          throw new Error(`HTTP Error: ${response.status}`);
        }
      } catch (error) {
        logToElement(apiResults, `Status endpoint error: ${error.message}`, true);
      }
    });
    
    // Test API root
    document.getElementById('test-api').addEventListener('click', async () => {
      logToElement(apiResults, 'Testing API root...');
      
      try {
        const response = await fetch(API_URL, { 
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          mode: 'cors'
        });
        
        if (response.ok) {
          const data = await response.json();
          logToElement(apiResults, 'API root successful');
          logToElement(apiResults, `Response: ${JSON.stringify(data, null, 2)}`);
        } else {
          throw new Error(`HTTP Error: ${response.status}`);
        }
      } catch (error) {
        logToElement(apiResults, `API root error: ${error.message}`, true);
      }
    });
    
    // Test WebSocket connection
    document.getElementById('test-ws').addEventListener('click', () => {
      wsStatus.innerHTML = '<p>Testing WebSocket connection...</p>';
      logToElement(wsLog, 'Connecting to WebSocket...');
      
      try {
        const ws = new WebSocket(WS_URL);
        
        ws.onopen = () => {
          wsStatus.innerHTML = '<p><span class="status-indicator status-success"></span> WebSocket connected</p>';
          logToElement(wsLog, 'WebSocket connection established');
          
          // Send a test message
          const testMessage = {
            type: 'test',
            message: 'Hello from direct test page',
            timestamp: new Date().toISOString()
          };
          
          ws.send(JSON.stringify(testMessage));
          logToElement(wsLog, `Sent: ${JSON.stringify(testMessage)}`);
        };
        
        ws.onmessage = (event) => {
          logToElement(wsLog, `Received: ${event.data}`);
        };
        
        ws.onerror = (error) => {
          wsStatus.innerHTML = '<p><span class="status-indicator status-error"></span> WebSocket error</p>';
          logToElement(wsLog, `WebSocket error: ${error.message || 'Unknown error'}`, true);
        };
        
        ws.onclose = (event) => {
          wsStatus.innerHTML = '<p><span class="status-indicator status-error"></span> WebSocket disconnected</p>';
          logToElement(wsLog, `WebSocket closed: Code ${event.code} ${event.reason}`);
        };
      } catch (error) {
        wsStatus.innerHTML = '<p><span class="status-indicator status-error"></span> WebSocket connection failed</p>';
        logToElement(wsLog, `WebSocket connection error: ${error.message}`, true);
      }
    });
    
    // Test login
    document.getElementById('test-login').addEventListener('click', async () => {
      logToElement(authResults, 'Testing login...');
      
      // Demo credentials - these would normally be entered by the user
      const credentials = {
        email: 'demo@example.com',
        password: 'demo123'
      };
      
      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(credentials),
          mode: 'cors'
        });
        
        const data = await response.json();
        
        if (response.ok && data.token) {
          logToElement(authResults, 'Login successful');
          logToElement(authResults, `Token: ${data.token.substring(0, 20)}...`);
          
          // Store token
          localStorage.setItem('gts_token', data.token);
          
          // Test authenticated request
          try {
            const userResponse = await fetch(`${API_URL}/auth/me`, {
              headers: {
                'Authorization': `Bearer ${data.token}`,
                'Accept': 'application/json'
              }
            });
            
            if (userResponse.ok) {
              const userData = await userResponse.json();
              logToElement(authResults, 'User data retrieved successfully');
              logToElement(authResults, `User: ${JSON.stringify(userData, null, 2)}`);
            } else {
              throw new Error(`HTTP Error: ${userResponse.status}`);
            }
          } catch (userError) {
            logToElement(authResults, `Error fetching user data: ${userError.message}`, true);
          }
        } else {
          throw new Error(data.message || 'Login failed');
        }
      } catch (error) {
        logToElement(authResults, `Login error: ${error.message}`, true);
      }
    });
    
    // Initialize
    checkConnection();
  </script>
</body>
</html>
